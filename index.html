<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>EAG FRUİT HİT</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      background: #111;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }
    canvas {
      background: #222;
      display: none;
      margin: auto;
      border: 4px solid lime;
      max-width: 100%;
      height: auto;
    }
    .menu, .game-over, .settings {
      display: none;
      padding-top: 100px;
    }
    .active {
      display: block;
    }
    button {
      padding: 10px 20px;
      font-size: 20px;
      background: lime;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin: 10px;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    #timer {
      font-size: 24px;
    }
    .controls {
      position: fixed;
      bottom: 10px;
      width: 100%;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      user-select: none;
    }
    .controls div {
      display: flex;
      gap: 10px;
    }
  </style>
</head>
<body>

  <div id="mainMenu" class="menu active">
    <h1>🍎 EAG FRUİT HİT 🍌</h1>
    <button id="btnStart">🎮 Oyuna Başla</button>
    <button id="btnSettings">⚙ Ayarlar</button>
  </div>

  <div id="settingsMenu" class="settings">
    <h2>⚙ Ayarlar</h2>
    <button id="btnFullscreen">⛶ Tam Ekran</button>
    <br />
    <button id="btnBack">⬅ Geri</button>
  </div>

  <p id="timer" style="display:none">⏱ Süre: 60</p>
  <canvas id="gameCanvas" width="800" height="500"></canvas>

  <div class="controls">
    <div>
      <button id="btnA">A</button>
      <button id="btnD">D</button>
      <button id="btnW">🔫</button>
    </div>
    <div>
      <button id="btnLeft">←</button>
      <button id="btnRight">→</button>
      <button id="btnUp">🔫</button>
    </div>
  </div>

  <div id="gameOverScreen" class="game-over">
    <h1 id="resultText">🏑 Oyun Bitti!</h1>
    <button id="btnRestart">🔁 Yeniden Oyna</button>
  </div>

  <script>
    let spawnInterval; 
    let controlInterval;
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const timerText = document.getElementById("timer");

    let popSound, winSound;
    try {
      popSound = new Audio('pop.mp3');
      winSound = new Audio('win.mp3');
    } catch (e) {
      console.warn("Ses yüklenemedi: ", e);
      popSound = { play: () => {} };
      winSound = { play: () => {} };
    }

    let timeLeft = 60;
    const players = [
      { x: 200, color: "red", keys: { left: "a", right: "d", shoot: "w" }, bullets: [], score: 0 },
      { x: 600, color: "blue", keys: { left: "ArrowLeft", right: "ArrowRight", shoot: "ArrowUp" }, bullets: [], score: 0 }
    ];

    const fruits = [];
    const bulletsSpeed = 6;
    const playerY = canvas.height - 50;
    const tableY = canvas.height - 70;

    const fruitTypes = [
      { name: "elma", color: "lime", point: 1 },
      { name: "muz", color: "yellow", point: 2 },
      { name: "portakal", color: "orange", point: 3 }
    ];

    let gameRunning = false;
    let countdownInterval;

    // Tuş durumu global
    const keysPressed = {
      a: false,
      d: false,
      w: false,
      ArrowLeft: false,
      ArrowRight: false,
      ArrowUp: false
    };

    // Mobil butonları dinle
    function setupButton(id, key) {
      const btn = document.getElementById(id);
      btn.addEventListener("touchstart", e => { e.preventDefault(); keysPressed[key] = true; });
      btn.addEventListener("touchend", e => { e.preventDefault(); keysPressed[key] = false; });
      btn.addEventListener("mousedown", () => keysPressed[key] = true);
      btn.addEventListener("mouseup", () => keysPressed[key] = false);
      btn.addEventListener("mouseleave", () => keysPressed[key] = false);
    }

    // Butonlara dokunmatik ve fare olaylarını bağla
    ["btnA", "btnD", "btnW", "btnLeft", "btnRight", "btnUp"].forEach((btnId, i) => {
      const keyMap = ['a', 'd', 'w', 'ArrowLeft', 'ArrowRight', 'ArrowUp'];
      setupButton(btnId, keyMap[i]);
    });

    // Klavye tuşları
    document.addEventListener("keydown", e => {
      if (keysPressed.hasOwnProperty(e.key)) keysPressed[e.key] = true;
    });
    document.addEventListener("keyup", e => {
      if (keysPressed.hasOwnProperty(e.key)) keysPressed[e.key] = false;
    });

    // Oyun fonksiyonları:

    function startGame() {
      document.getElementById("mainMenu").classList.remove("active");
      document.getElementById("settingsMenu").classList.remove("active");
      document.getElementById("gameOverScreen").classList.remove("active");
      canvas.style.display = "block";
      timerText.style.display = "block";
      gameRunning = true;
      timeLeft = 60;
      countdown();
      if (spawnInterval) clearInterval(spawnInterval);
      if (controlInterval) clearInterval(controlInterval);
      spawnInterval = setInterval(spawnFruit, 1000);
      controlInterval = setInterval(controlPlayers, 30);
      updateGame();
      // skorları sıfırla
      players.forEach(p => {
        p.score = 0;
        p.bullets = [];
        p.x = p === players[0] ? 200 : 600;
      });
    }

    function openSettings() {
      document.getElementById("mainMenu").classList.remove("active");
      document.getElementById("settingsMenu").classList.add("active");
    }

    function closeSettings() {
      document.getElementById("settingsMenu").classList.remove("active");
      document.getElementById("mainMenu").classList.add("active");
    }

    function toggleFullscreen() {
      if (document.fullscreenEnabled) {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().catch(err => console.warn("Fullscreen hatası:", err));
        } else {
          document.exitFullscreen();
        }
      } else {
        alert("Tarayıcınız tam ekran modunu desteklemiyor.");
      }
    }

    function spawnFruit() {
      if (!gameRunning) return;
      const fruit = fruitTypes[Math.floor(Math.random() * fruitTypes.length)];
      const x = Math.random() * (canvas.width - 30);
      fruits.push({ x, y: 50, w: 30, h: 30, type: fruit });
    }

    function drawPlayers() {
      players.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, playerY, 30, 30);
      });
    }

    function drawBullets() {
      players.forEach(p => {
        ctx.fillStyle = "white";
        p.bullets.forEach(b => {
          ctx.fillRect(b.x, b.y, 5, 10);
        });
      });
    }

    function drawFruits() {
      fruits.forEach(f => {
        ctx.fillStyle = f.type.color;
        ctx.beginPath();
        ctx.arc(f.x + 15, f.y + 15, 15, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function drawTable() {
      ctx.fillStyle = "#654321";
      ctx.fillRect(0, tableY, canvas.width, 20);
    }

    function drawScores() {
      ctx.fillStyle = "white";
      ctx.font = "20px Arial";
      ctx.fillText("Oyuncu 1 Skor: " + players[0].score, 10, 25);
      ctx.fillText("Oyuncu 2 Skor: " + players[1].score, 600, 25);
    }

    function updateGame() {
      if (!gameRunning) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawTable();
      drawPlayers();
      drawBullets();
      drawFruits();
      drawScores();

      players.forEach(p => {
        p.bullets.forEach(b => b.y -= bulletsSpeed);
        p.bullets = p.bullets.filter(b => b.y > 0);
      });

      players.forEach(p => {
        p.bullets.forEach(bullet => {
          fruits.forEach((fruit, index) => {
            if (
              bullet.x < fruit.x + fruit.w &&
              bullet.x + 5 > fruit.x &&
              bullet.y < fruit.y + fruit.h &&
              bullet.y + 10 > fruit.y
            ) {
              p.score += fruit.type.point;
              fruits.splice(index, 1);
              bullet.y = -20;
              if (popSound && popSound.play) {
                popSound.currentTime = 0;
                popSound.play().catch(() => {});
              }
            }
          });
        });
      });

      requestAnimationFrame(updateGame);
    }

    function controlPlayers() {
      if (!gameRunning) return;
      if (keysPressed[players[0].keys.left]) players[0].x = Math.max(0, players[0].x - 4);
      if (keysPressed[players[0].keys.right]) players[0].x = Math.min(canvas.width - 30, players[0].x + 4);
      if (keysPressed[players[0].keys.shoot]) shoot(players[0]);

      if (keysPressed[players[1].keys.left]) players[1].x = Math.max(0, players[1].x - 4);
      if (keysPressed[players[1].keys.right]) players[1].x = Math.min(canvas.width - 30, players[1].x + 4);
      if (keysPressed[players[1].keys.shoot]) shoot(players[1]);
    }

    function shoot(player) {
      if (!player.lastShot || Date.now() - player.lastShot > 400) {
        player.bullets.push({ x: player.x + 12, y: playerY });
        player.lastShot = Date.now();
      }
    }

    function countdown() {
      clearInterval(countdownInterval);
      countdownInterval = setInterval(() => {
        timeLeft--;
        timerText.textContent = `⏱ Süre: ${timeLeft}`;
        if (timeLeft <= 0) {
          clearInterval(countdownInterval);
          endGame();
        }
      }, 1000);
    }

    function endGame() {
      gameRunning = false;
      canvas.style.display = "none";
      timerText.style.display = "none";
      document.getElementById("gameOverScreen").classList.add("active");

      if (winSound && winSound.play) {
        winSound.play().catch(() => {});
      }

      let p1 = players[0].score;
      let p2 = players[1].score;
      const result = document.getElementById("resultText");

      if (p1 > p2) result.textContent = `🎉 Oyuncu 1 Kazandı! Skor: ${p1}`;
      else if (p2 > p1) result.textContent = `🎉 Oyuncu 2 Kazandı! Skor: ${p2}`;
      else result.textContent = `🤝 Berabere! Skor: ${p1}`;
    }

    function restartGame() {
      location.reload();
    }

    // Butonlara event listener bağla
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById("btnStart").addEventListener("click", startGame);
      document.getElementById("btnSettings").addEventListener("click", openSettings);
      document.getElementById("btnBack").addEventListener("click", closeSettings);
      document.getElementById("btnFullscreen").addEventListener("click", toggleFullscreen);
      document.getElementById("btnRestart").addEventListener("click", restartGame);
    });

  </script>
</body>
</html>
